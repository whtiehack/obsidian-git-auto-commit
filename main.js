var P=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var V=(n,s)=>{for(var t in s)P(n,t,{get:s[t],enumerable:!0})},k=(n,s,t,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of M(s))!U.call(n,i)&&i!==t&&P(n,i,{get:()=>s[i],enumerable:!(e=I(s,i))||e.enumerable});return n};var z=n=>k(P({},"__esModule",{value:!0}),n);var H={};V(H,{default:()=>w});module.exports=z(H);var l=require("obsidian");var a=require("obsidian");var W={settingsTitle:"Auto Git Commit",sectionAutomation:"Automation",sectionConfiguration:"Configuration",sectionRepository:"Repository",autoCommitName:"Enable auto commit",autoCommitDesc:"Automatically commit when files change (debounced).",debounceName:"Debounce delay (seconds)",debounceDesc:"Wait time after last change before committing.",autoPushName:"Auto push after commit",autoPushDesc:"Push to remote after successful commit.",autoPullOnOpenName:"Auto pull on open",autoPullOnOpenDesc:"Pull from remote when Obsidian opens.",templateName:"Commit message template",templateDesc:"Variables: {{date}}, {{time}}, {{files}}, {{count}}",gitPathName:"Git binary path",gitPathDesc:"Path to git executable. Default: git",ignoreObsidianName:"Ignore .obsidian directory",ignoreObsidianDesc:"Exclude config folder from triggering auto-commits.",includeFileListName:"Include file list in commit body",includeFileListDesc:"List changed files in commit message body, one per line.",showStatusBadgeName:"Show git status in file explorer",showStatusBadgeDesc:"Display colored dots next to changed files and folders.",repoStatusName:"Repository status",repoNotInitialized:"Not a git repository",repoInitialized:"Git repository initialized",initRepoButton:"Initialize repository",pullNowName:"Pull from remote",pullNowDesc:"Fetch and merge changes from the remote repository.",pullNowButton:"Pull",commitPushName:"Commit and push",commitPushDesc:"Commit all changes and push to the remote repository.",commitPushButton:"Commit & Push",remoteUrlName:"Remote URL (origin)",remoteUrlDesc:"Set the remote repository URL for push.",remoteUrlPlaceholder:"https://github.com/user/repo.git",saveButton:"Save",conflictStatusName:"Merge conflicts detected",conflictStatusDesc:"Please resolve conflicts manually, then click the button below.",resolveConflictButton:"Mark as resolved",noticeNoChanges:"GitAutoCommit: No changes to commit.",noticeCommitted:n=>`GitAutoCommit: Committed ${n} file(s).`,noticePushed:"GitAutoCommit: Pushed to remote.",noticePulled:"GitAutoCommit: Pulled from remote.",noticeAutoGitError:n=>`GitAutoCommit: Error - ${n}`,noticePushFailed:n=>`GitAutoCommit: Push failed - ${n}`,noticePullFailed:n=>`GitAutoCommit: Pull failed - ${n}`,noticeMobileNotSupported:"GitAutoCommit: Git not available on mobile.",noticeDesktopOnly:"GitAutoCommit: Requires desktop vault.",noticeRepoInitialized:"GitAutoCommit: Repository initialized.",noticeRemoteSaved:"GitAutoCommit: Remote URL saved.",noticeConflictDetected:"GitAutoCommit: Merge conflicts detected! Please resolve manually.",noticeConflictResolved:"GitAutoCommit: Conflicts marked as resolved.",noticeCannotCommitConflict:"GitAutoCommit: Cannot commit while conflicts exist."},S={settingsTitle:"\u81EA\u52A8 Git \u63D0\u4EA4",sectionAutomation:"\u81EA\u52A8\u5316",sectionConfiguration:"\u914D\u7F6E",sectionRepository:"\u4ED3\u5E93",autoCommitName:"\u542F\u7528\u81EA\u52A8\u63D0\u4EA4",autoCommitDesc:"\u6587\u4EF6\u53D8\u52A8\u540E\u81EA\u52A8\u63D0\u4EA4\uFF08\u9632\u6296\uFF09\u3002",debounceName:"\u9632\u6296\u5EF6\u8FDF\uFF08\u79D2\uFF09",debounceDesc:"\u6700\u540E\u4E00\u6B21\u53D8\u52A8\u540E\u7B49\u5F85\u591A\u4E45\u518D\u63D0\u4EA4\u3002",autoPushName:"\u63D0\u4EA4\u540E\u81EA\u52A8\u63A8\u9001",autoPushDesc:"\u63D0\u4EA4\u6210\u529F\u540E\u81EA\u52A8\u63A8\u9001\u5230\u8FDC\u7A0B\u4ED3\u5E93\u3002",autoPullOnOpenName:"\u6253\u5F00\u65F6\u81EA\u52A8\u62C9\u53D6",autoPullOnOpenDesc:"\u6253\u5F00 Obsidian \u65F6\u81EA\u52A8\u4ECE\u8FDC\u7A0B\u4ED3\u5E93\u62C9\u53D6\u3002",templateName:"\u63D0\u4EA4\u6D88\u606F\u6A21\u677F",templateDesc:"\u53D8\u91CF: {{date}}, {{time}}, {{files}}, {{count}}",gitPathName:"Git \u53EF\u6267\u884C\u6587\u4EF6\u8DEF\u5F84",gitPathDesc:"git \u7684\u8DEF\u5F84\uFF0C\u9ED8\u8BA4: git",ignoreObsidianName:"\u5FFD\u7565 .obsidian \u76EE\u5F55",ignoreObsidianDesc:"\u6392\u9664\u914D\u7F6E\u6587\u4EF6\u5939\u89E6\u53D1\u81EA\u52A8\u63D0\u4EA4\u3002",includeFileListName:"\u5728\u63D0\u4EA4\u6B63\u6587\u4E2D\u5305\u542B\u6587\u4EF6\u5217\u8868",includeFileListDesc:"\u5728\u63D0\u4EA4\u6D88\u606F\u6B63\u6587\u4E2D\u5217\u51FA\u53D8\u52A8\u7684\u6587\u4EF6\uFF0C\u6BCF\u884C\u4E00\u4E2A\u3002",showStatusBadgeName:"\u5728\u6587\u4EF6\u5217\u8868\u663E\u793A Git \u72B6\u6001",showStatusBadgeDesc:"\u5728\u53D8\u52A8\u7684\u6587\u4EF6\u548C\u6587\u4EF6\u5939\u65C1\u663E\u793A\u5F69\u8272\u5706\u70B9\u3002",repoStatusName:"\u4ED3\u5E93\u72B6\u6001",repoNotInitialized:"\u5C1A\u672A\u521D\u59CB\u5316\u4E3A Git \u4ED3\u5E93",repoInitialized:"Git \u4ED3\u5E93\u5DF2\u521D\u59CB\u5316",initRepoButton:"\u521D\u59CB\u5316\u4ED3\u5E93",pullNowName:"\u4ECE\u8FDC\u7A0B\u62C9\u53D6",pullNowDesc:"\u4ECE\u8FDC\u7A0B\u4ED3\u5E93\u83B7\u53D6\u5E76\u5408\u5E76\u66F4\u6539\u3002",pullNowButton:"\u62C9\u53D6",commitPushName:"\u63D0\u4EA4\u5E76\u63A8\u9001",commitPushDesc:"\u63D0\u4EA4\u6240\u6709\u66F4\u6539\u5E76\u63A8\u9001\u5230\u8FDC\u7A0B\u4ED3\u5E93\u3002",commitPushButton:"\u63D0\u4EA4\u5E76\u63A8\u9001",remoteUrlName:"\u8FDC\u7A0B\u4ED3\u5E93\u5730\u5740 (origin)",remoteUrlDesc:"\u8BBE\u7F6E\u7528\u4E8E\u63A8\u9001\u7684\u8FDC\u7A0B\u4ED3\u5E93\u5730\u5740\u3002",remoteUrlPlaceholder:"https://github.com/user/repo.git",saveButton:"\u4FDD\u5B58",conflictStatusName:"\u68C0\u6D4B\u5230\u5408\u5E76\u51B2\u7A81",conflictStatusDesc:"\u8BF7\u624B\u52A8\u89E3\u51B3\u51B2\u7A81\u540E\uFF0C\u70B9\u51FB\u4E0B\u65B9\u6309\u94AE\u3002",resolveConflictButton:"\u6807\u8BB0\u4E3A\u5DF2\u89E3\u51B3",noticeNoChanges:"GitAutoCommit: \u6CA1\u6709\u53EF\u63D0\u4EA4\u7684\u66F4\u6539\u3002",noticeCommitted:n=>`GitAutoCommit: \u5DF2\u63D0\u4EA4 ${n} \u4E2A\u6587\u4EF6\u3002`,noticePushed:"GitAutoCommit: \u5DF2\u63A8\u9001\u5230\u8FDC\u7A0B\u4ED3\u5E93\u3002",noticePulled:"GitAutoCommit: \u5DF2\u4ECE\u8FDC\u7A0B\u4ED3\u5E93\u62C9\u53D6\u3002",noticeAutoGitError:n=>`GitAutoCommit: \u9519\u8BEF - ${n}`,noticePushFailed:n=>`GitAutoCommit: \u63A8\u9001\u5931\u8D25 - ${n}`,noticePullFailed:n=>`GitAutoCommit: \u62C9\u53D6\u5931\u8D25 - ${n}`,noticeMobileNotSupported:"GitAutoCommit: \u79FB\u52A8\u7AEF\u4E0D\u652F\u6301 Git\u3002",noticeDesktopOnly:"GitAutoCommit: \u9700\u8981\u684C\u9762\u7AEF\u3002",noticeRepoInitialized:"GitAutoCommit: \u4ED3\u5E93\u5DF2\u521D\u59CB\u5316\u3002",noticeRemoteSaved:"GitAutoCommit: \u8FDC\u7A0B\u5730\u5740\u5DF2\u4FDD\u5B58\u3002",noticeConflictDetected:"GitAutoCommit: \u68C0\u6D4B\u5230\u5408\u5E76\u51B2\u7A81\uFF01\u8BF7\u624B\u52A8\u89E3\u51B3\u3002",noticeConflictResolved:"GitAutoCommit: \u51B2\u7A81\u5DF2\u6807\u8BB0\u4E3A\u89E3\u51B3\u3002",noticeCannotCommitConflict:"GitAutoCommit: \u5B58\u5728\u51B2\u7A81\u65F6\u65E0\u6CD5\u63D0\u4EA4\u3002"},y={en:W,zh:S,"zh-CN":S,"zh-TW":S};function _(){return window.localStorage.getItem("language")||"en"}function g(){let n=_();return y[n]||y.en}var D=require("child_process");function h({cwd:n,gitPath:s,args:t}){return new Promise((e,i)=>{(0,D.execFile)(s,t,{cwd:n,windowsHide:!0,env:{...process.env,GIT_TERMINAL_PROMPT:"0"}},(o,u,c)=>{if(o){i(new Error((c==null?void 0:c.trim())||o.message));return}e(u)})})}async function A(n,s){let t=await h({cwd:n,gitPath:s,args:["status","--porcelain=v1","-z"]});if(!t)return[];let e=t.split("\0").filter(Boolean),i=[];for(let o=0;o<e.length;o++){let u=e[o],c=u.slice(0,2),m=u.slice(3);if(m&&i.push(m),c.startsWith("R")||c.startsWith("C")){let r=e[++o];r&&i.push(r)}}return[...new Set(i)]}async function R(n,s,t){await h({cwd:n,gitPath:s,args:["add","-A"]});try{await h({cwd:n,gitPath:s,args:["commit","-m",t]})}catch(e){let i=e.message;if(i.includes("nothing to commit")||i.includes("no changes added"))return;throw e}}async function B(n,s){return(await h({cwd:n,gitPath:s,args:["rev-parse","--abbrev-ref","HEAD"]})).trim()}async function T(n,s){let t=await B(n,s);await h({cwd:n,gitPath:s,args:["push","-u","origin",t]})}async function p(n,s){try{let t=await B(n,s);return{success:!0,hasConflicts:!1,message:await h({cwd:n,gitPath:s,args:["pull","origin",t]})}}catch(t){let e=t.message;if(e.includes("CONFLICT")||e.includes("Merge conflict"))return{success:!1,hasConflicts:!0,message:e};throw t}}async function v(n,s){try{return(await h({cwd:n,gitPath:s,args:["diff","--name-only","--diff-filter=U"]})).split(`
`).map(e=>e.trim()).filter(Boolean)}catch(t){return[]}}async function F(n,s){return(await v(n,s)).length>0}async function f(n,s){await h({cwd:n,gitPath:s,args:["add","-A"]})}async function G(n,s){try{return await h({cwd:n,gitPath:s,args:["rev-parse","--git-dir"]}),!0}catch(t){return!1}}async function O(n,s){await h({cwd:n,gitPath:s,args:["init"]})}async function b(n,s){try{return(await h({cwd:n,gitPath:s,args:["remote","get-url","origin"]})).trim()}catch(t){return""}}async function E(n,s,t){await b(n,s)?await h({cwd:n,gitPath:s,args:["remote","set-url","origin",t]}):await h({cwd:n,gitPath:s,args:["remote","add","origin",t]})}async function x(n,s){let t=new Map;try{let e=await h({cwd:n,gitPath:s,args:["status","--porcelain=v1","-z"]});if(!e)return t;let i=e.split("\0").filter(Boolean);for(let o=0;o<i.length;o++){let u=i[o],c=u.slice(0,2),m=u.slice(3),r="";c==="??"||c.includes("?")||c.includes("A")?r="A":c.includes("D")?r="D":c.includes("R")?r="R":(c.includes("M")||c.includes("U"))&&(r="M"),m&&r&&t.set(m,r),(c.startsWith("R")||c.startsWith("C"))&&o++}}catch(e){}return t}var N={autoCommit:!1,debounceSeconds:30,commitTemplate:"vault backup: {{date}} {{time}}",includeFileList:!0,autoPush:!1,autoPullOnOpen:!1,gitPath:"git",ignoreObsidianDir:!0,showStatusBadge:!0},C=class extends a.PluginSettingTab{constructor(s,t){super(s,t),this.plugin=t}display(){let{containerEl:s}=this,t=g();if(s.empty(),s.createEl("h2",{text:t.settingsTitle}),!a.Platform.isMobileApp){s.createEl("h3",{text:t.sectionRepository});let e=s.createDiv();e.setText("Loading..."),this.displayRepoSection(e)}s.createEl("h3",{text:t.sectionAutomation}),new a.Setting(s).setName(t.autoPullOnOpenName).setDesc(t.autoPullOnOpenDesc).addToggle(e=>e.setValue(this.plugin.settings.autoPullOnOpen).onChange(async i=>{this.plugin.settings.autoPullOnOpen=i,await this.plugin.saveSettings()})),new a.Setting(s).setName(t.autoCommitName).setDesc(t.autoCommitDesc).addToggle(e=>e.setValue(this.plugin.settings.autoCommit).onChange(async i=>{this.plugin.settings.autoCommit=i,await this.plugin.saveSettings(),this.plugin.resetVaultListeners(),this.display()})),this.plugin.settings.autoCommit&&(new a.Setting(s).setName(t.debounceName).setDesc(t.debounceDesc).addText(e=>e.setPlaceholder("30").setValue(String(this.plugin.settings.debounceSeconds)).onChange(async i=>{let o=parseInt(i);!isNaN(o)&&o>=5&&(this.plugin.settings.debounceSeconds=o,await this.plugin.saveSettings())})),new a.Setting(s).setName(t.autoPushName).setDesc(t.autoPushDesc).addToggle(e=>e.setValue(this.plugin.settings.autoPush).onChange(async i=>{this.plugin.settings.autoPush=i,await this.plugin.saveSettings()}))),s.createEl("h3",{text:t.sectionConfiguration}),new a.Setting(s).setName(t.templateName).setDesc(t.templateDesc).addTextArea(e=>e.setPlaceholder("vault backup: {{date}} {{time}}").setValue(this.plugin.settings.commitTemplate).onChange(async i=>{this.plugin.settings.commitTemplate=i,await this.plugin.saveSettings()})),new a.Setting(s).setName(t.includeFileListName).setDesc(t.includeFileListDesc).addToggle(e=>e.setValue(this.plugin.settings.includeFileList).onChange(async i=>{this.plugin.settings.includeFileList=i,await this.plugin.saveSettings()})),new a.Setting(s).setName(t.showStatusBadgeName).setDesc(t.showStatusBadgeDesc).addToggle(e=>e.setValue(this.plugin.settings.showStatusBadge).onChange(async i=>{this.plugin.settings.showStatusBadge=i,await this.plugin.saveSettings(),this.plugin.refreshStatusBadges()})),new a.Setting(s).setName(t.gitPathName).setDesc(t.gitPathDesc).addText(e=>e.setPlaceholder("git").setValue(this.plugin.settings.gitPath).onChange(async i=>{this.plugin.settings.gitPath=i.trim()||"git",await this.plugin.saveSettings()})),new a.Setting(s).setName(t.ignoreObsidianName).setDesc(t.ignoreObsidianDesc).addToggle(e=>e.setValue(this.plugin.settings.ignoreObsidianDir).onChange(async i=>{this.plugin.settings.ignoreObsidianDir=i,await this.plugin.saveSettings()}))}async displayRepoSection(s){let t=g(),e=this.plugin.getVaultPathSafe();if(!e){s.empty();return}let i=this.plugin.settings.gitPath,[o,u,c]=await Promise.all([G(e,i),b(e,i),F(e,i)]);if(s.empty(),!o)new a.Setting(s).setName(t.repoStatusName).setDesc(t.repoNotInitialized).addButton(m=>m.setButtonText(t.initRepoButton).onClick(async()=>{try{await O(e,i),new a.Notice(t.noticeRepoInitialized),this.display()}catch(r){new a.Notice(r.message)}}));else{new a.Setting(s).setName(t.repoStatusName).setDesc(t.repoInitialized),new a.Setting(s).setName(t.pullNowName).setDesc(t.pullNowDesc).addButton(r=>r.setButtonText(t.pullNowButton).onClick(async()=>{try{(await p(e,i)).hasConflicts?(this.plugin.setHasConflicts(!0),new a.Notice(t.noticeConflictDetected),this.display()):(new a.Notice(t.noticePulled),this.plugin.refreshStatusBadges())}catch(d){new a.Notice(t.noticePullFailed(d.message))}})),new a.Setting(s).setName(t.commitPushName).setDesc(t.commitPushDesc).addButton(r=>r.setButtonText(t.commitPushButton).onClick(async()=>{await this.plugin.runCommit("manual")&&await this.plugin.doPush()}));let m=u;new a.Setting(s).setName(t.remoteUrlName).setDesc(t.remoteUrlDesc).addText(r=>r.setPlaceholder(t.remoteUrlPlaceholder).setValue(u).onChange(d=>{m=d.trim()})).addButton(r=>r.setButtonText(t.saveButton).onClick(async()=>{if(m)try{await E(e,i,m),new a.Notice(t.noticeRemoteSaved)}catch(d){new a.Notice(d.message)}})),c&&new a.Setting(s).setName(t.conflictStatusName).setDesc(t.conflictStatusDesc).addButton(r=>r.setButtonText(t.resolveConflictButton).setWarning().onClick(async()=>{try{await f(e,i),this.plugin.setHasConflicts(!1),new a.Notice(t.noticeConflictResolved),this.display()}catch(d){new a.Notice(d.message)}}))}}};function L(n,s){return n.replace(/\{\{\s*([a-zA-Z0-9_]+)\s*\}\}/g,(t,e)=>{var i;return(i=s[e])!=null?i:""})}var w=class extends l.Plugin{constructor(){super(...arguments);this.settings=N;this.debounceTimer=null;this.isCommitting=!1;this.pendingRerun=!1;this.vaultEventRefs=[];this.statusRefreshInterval=null;this.currentStatuses=new Map;this.conflictFiles=new Set;this._hasConflicts=!1;this.resolveConflictCommand=null}async onload(){await this.loadSettings(),this.addSettingTab(new C(this.app,this)),this.addCommand({id:"commit-now",name:"Commit now",callback:()=>this.runCommit("manual")}),this.addCommand({id:"commit-and-push",name:"Commit and push",callback:async()=>{await this.runCommit("manual")&&await this.doPush()}}),this.addCommand({id:"pull-now",name:"Pull now",callback:()=>this.doPull()}),this.setupVaultListeners(),this.setupStatusBadges(),this.settings.autoPullOnOpen&&!l.Platform.isMobileApp&&window.setTimeout(()=>this.doPull(),1e3),this.checkConflicts()}onunload(){this.clearDebounce(),this.removeVaultListeners(),this.clearStatusBadges(),this.statusRefreshInterval&&window.clearInterval(this.statusRefreshInterval)}async loadSettings(){this.settings=Object.assign({},N,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}resetVaultListeners(){this.clearDebounce(),this.removeVaultListeners(),this.setupVaultListeners()}removeVaultListeners(){this.vaultEventRefs.forEach(t=>this.app.vault.offref(t)),this.vaultEventRefs=[]}setupVaultListeners(){if(!this.settings.autoCommit)return;if(l.Platform.isMobileApp){new l.Notice(g().noticeMobileNotSupported);return}let t=e=>this.onFileChange(e);this.vaultEventRefs.push(this.app.vault.on("create",t)),this.vaultEventRefs.push(this.app.vault.on("modify",t)),this.vaultEventRefs.push(this.app.vault.on("delete",t)),this.vaultEventRefs.push(this.app.vault.on("rename",t))}onFileChange(t){t instanceof l.TFile&&(this.shouldIgnore(t.path)||(this.scheduleCommit(),this.scheduleStatusRefresh()))}shouldIgnore(t){return!!(t.startsWith(".git/")||t.startsWith(".git\\")||this.settings.ignoreObsidianDir&&(t.startsWith(".obsidian/")||t.startsWith(".obsidian\\")))}scheduleCommit(){this.clearDebounce(),this.debounceTimer=window.setTimeout(()=>{this.debounceTimer=null,this.runCommit("auto")},this.settings.debounceSeconds*1e3)}clearDebounce(){this.debounceTimer!==null&&(window.clearTimeout(this.debounceTimer),this.debounceTimer=null)}getVaultPath(){let t=this.app.vault.adapter;if(!(t instanceof l.FileSystemAdapter))throw new Error(g().noticeDesktopOnly);return t.getBasePath()}getVaultPathSafe(){let t=this.app.vault.adapter;return t instanceof l.FileSystemAdapter?t.getBasePath():null}async runCommit(t){if(this._hasConflicts)return t==="manual"&&new l.Notice(g().noticeCannotCommitConflict),!1;if(this.isCommitting)return this.pendingRerun=!0,!1;this.isCommitting=!0,this.pendingRerun=!1;let e=!1;try{let i=this.getVaultPath(),o=this.settings.gitPath,u=await A(i,o);if(u.length===0)return t==="manual"&&new l.Notice(g().noticeNoChanges),!1;let c=new Date,m=L(this.settings.commitTemplate,{date:c.toISOString().slice(0,10),time:c.toTimeString().slice(0,8),files:u.slice(0,5).join(", ")+(u.length>5?"...":""),count:String(u.length)}),r=m;this.settings.includeFileList&&(r=m+`

`+u.join(`
`)),await R(i,o,r),e=!0,new l.Notice(g().noticeCommitted(u.length)),this.settings.autoPush&&await this.doPush(),this.refreshStatusBadges()}catch(i){new l.Notice(g().noticeAutoGitError(i.message))}finally{this.isCommitting=!1,this.pendingRerun&&this.scheduleCommit()}return e}async doPush(){try{let t=this.getVaultPath();await T(t,this.settings.gitPath),new l.Notice(g().noticePushed)}catch(t){new l.Notice(g().noticePushFailed(t.message))}}async doPull(){if(l.Platform.isMobileApp){new l.Notice(g().noticeMobileNotSupported);return}try{let t=this.getVaultPath(),e=await p(t,this.settings.gitPath);e.hasConflicts?(await this.checkConflicts(),new l.Notice(g().noticeConflictDetected)):e.success&&(new l.Notice(g().noticePulled),this.refreshStatusBadges())}catch(t){new l.Notice(g().noticePullFailed(t.message))}}async checkConflicts(){let t=this.getVaultPathSafe();if(!t)return;let e=await v(t,this.settings.gitPath);this.conflictFiles=new Set(e),this.setHasConflicts(e.length>0),this.refreshStatusBadges()}setHasConflicts(t){this._hasConflicts=t,t&&!this.resolveConflictCommand?this.resolveConflictCommand=this.addCommand({id:"resolve-conflicts",name:"Mark conflicts as resolved",callback:async()=>{let e=this.getVaultPathSafe();if(e)try{await f(e,this.settings.gitPath),this.conflictFiles.clear(),this.setHasConflicts(!1),new l.Notice(g().noticeConflictResolved),this.refreshStatusBadges()}catch(i){new l.Notice(i.message)}}}):!t&&this.resolveConflictCommand&&(this.resolveConflictCommand=null),t||this.conflictFiles.clear()}setupStatusBadges(){l.Platform.isMobileApp||!this.settings.showStatusBadge||(this.refreshStatusBadges(),this.statusRefreshInterval=window.setInterval(()=>{this.refreshStatusBadges()},5e3))}scheduleStatusRefresh(){this.settings.showStatusBadge&&window.setTimeout(()=>this.refreshStatusBadges(),500)}refreshStatusBadges(){if(!this.settings.showStatusBadge){this.clearStatusBadges();return}let t=this.getVaultPathSafe();t&&x(t,this.settings.gitPath).then(e=>{this.currentStatuses=e,this.updateBadgesInDOM()})}clearStatusBadges(){document.querySelectorAll(".git-status-badge").forEach(t=>t.remove()),this.currentStatuses.clear()}updateBadgesInDOM(){document.querySelectorAll(".git-status-badge").forEach(i=>i.remove());let t=new Map(this.currentStatuses);this.conflictFiles.forEach(i=>{t.set(i,"U")});let e=this.calculateFolderStatuses(t);document.querySelectorAll(".nav-file-title").forEach(i=>{let o=i.getAttribute("data-path");if(!o)return;let u=t.get(o);u&&this.addBadgeToElement(i,u)}),document.querySelectorAll(".nav-folder-title").forEach(i=>{let o=i.getAttribute("data-path");if(!o)return;let u=e.get(o);u&&this.addBadgeToElement(i,u)})}calculateFolderStatuses(t){let e=t||this.currentStatuses,i=new Map;return e.forEach((o,u)=>{let c=u.split(/[/\\]/);for(let m=1;m<c.length;m++){let r=c.slice(0,m).join("/"),d=i.get(r);(!d||this.statusPriority(o)>this.statusPriority(d))&&i.set(r,o)}}),i}statusPriority(t){switch(t){case"U":return 5;case"A":return 4;case"M":return 3;case"R":return 2;case"D":return 1;default:return 0}}addBadgeToElement(t,e){let i=document.createElement("span");i.className="git-status-badge",i.textContent="\u25CF",e==="U"?i.classList.add("conflict"):e==="M"?i.classList.add("modified"):e==="A"?i.classList.add("added"):e==="D"?i.classList.add("deleted"):e==="R"&&i.classList.add("renamed"),t.appendChild(i)}};
